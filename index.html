<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buktiku Elite Pro</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}

body{
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    overflow:hidden;
    background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#1e3c72);
    background-size:400% 400%;
    animation:gradientBG 15s ease infinite;
}

@keyframes gradientBG{
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
}

/* floating blur balls */
body::before, body::after{
    content:'';
    position:absolute;
    width:400px;height:400px;
    border-radius:50%;
    filter:blur(120px);
    opacity:0.4;
    animation:float 12s ease-in-out infinite alternate;
}
body::before{
    background:#4e73df;
    top:-100px;left:-100px;
}
body::after{
    background:#1cc88a;
    bottom:-100px;right:-100px;
}

@keyframes float{
    from{transform:translateY(0px);}
    to{transform:translateY(60px);}
}

.container{
    width:95%;
    max-width:480px;
    backdrop-filter:blur(25px);
    background:rgba(255,255,255,0.08);
    border-radius:30px;
    padding:30px;
    box-shadow:0 25px 60px rgba(0,0,0,0.4);
    position:relative;
    z-index:10;
}

.logo{
    text-align:center;
    margin-bottom:10px;
}

.logo img{
    width:90px;
    height:90px;
    border-radius:50%;
    object-fit:cover;
    box-shadow:0 10px 30px rgba(0,0,0,0.4);
}

.title{
    text-align:center;
    color:white;
    font-size:22px;
    font-weight:600;
    margin-bottom:25px;
}

.total-box{
    background:rgba(255,255,255,0.15);
    padding:20px;
    border-radius:20px;
    text-align:center;
    color:white;
    margin-bottom:20px;
}

.total-box h1{
    font-size:28px;
    margin-top:5px;
}

input{
    width:100%;
    padding:14px;
    margin-bottom:12px;
    border-radius:15px;
    border:none;
    background:rgba(255,255,255,0.15);
    color:white;
    font-size:14px;
}

input::placeholder{color:#ddd;}

button{
    width:100%;
    padding:14px;
    border-radius:15px;
    border:none;
    background:linear-gradient(135deg,#4e73df,#1cc88a);
    color:white;
    font-weight:600;
    cursor:pointer;
    margin-bottom:20px;
    transition:0.3s;
}

button:hover{
    transform:translateY(-2px);
    box-shadow:0 10px 25px rgba(0,0,0,0.3);
}

.table-container{
    max-height:200px;
    overflow:auto;
}

table{
    width:100%;
    color:white;
    font-size:13px;
}

table td{
    padding:6px 0;
    border-top:1px solid rgba(255,255,255,0.1);
}

img.preview{
    width:40px;
    height:40px;
    border-radius:8px;
    object-fit:cover;
}

::-webkit-scrollbar{display:none;}
</style>
</head>

<body>

<div class="container">

<div class="logo">
<img src="https://i.imgur.com/6VBx3io.png">
</div>

<div class="title">Buktiku Elite Pro</div>

<div class="total-box">
<h3>Total Transaksi</h3>
<h1 id="total">Rp 0</h1>
</div>

<input type="date" id="tanggal">
<input type="number" id="nominal" placeholder="Nominal">
<input type="text" id="keterangan" placeholder="Keterangan">
<input type="file" id="bukti">
<button onclick="simpan()">Simpan Transaksi</button>

<div class="table-container">
<table>
<tbody id="data"></tbody>
</table>
</div>

</div>

<script>
const supabase = window.supabase.createClient(
'https://xrvvwyrvjwloxxvcurev.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhydnZ3eXJ2andsb3h4dmN1cmV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0NzEwMTksImV4cCI6MjA4NzA0NzAxOX0.ZgC-oi8RaqKK4tkzPpECO_fOUUMUqFpl0p6oxkXMJK8'
);

async function loadData(){
    const { data } = await supabase
    .from('transaksi')
    .select('*')
    .order('created_at',{ascending:false});

    let total=0;
    let html='';

    data.forEach(item=>{
        total+=item.nominal;
        html+=`
        <tr>
            <td>${item.tanggal}</td>
            <td>Rp ${item.nominal.toLocaleString()}</td>
            <td><img src="${item.bukti_url}" class="preview"></td>
        </tr>`;
    });

    document.getElementById('data').innerHTML=html;
    document.getElementById('total').innerText='Rp '+total.toLocaleString();
}

async function simpan(){
    const tanggal=document.getElementById('tanggal').value;
    const nominal=parseInt(document.getElementById('nominal').value);
    const keterangan=document.getElementById('keterangan').value;
    const file=document.getElementById('bukti').files[0];

    if(!tanggal||!nominal||!file){
        alert("Lengkapi data + upload gambar");
        return;
    }

    const fileName=Date.now()+"-"+file.name;

    const { error:uploadError } = await supabase
    .storage.from('bukti')
    .upload(fileName,file);

    if(uploadError){
        alert(uploadError.message);
        return;
    }

    const { data:urlData } = supabase
    .storage.from('bukti')
    .getPublicUrl(fileName);

    const bukti_url=urlData.publicUrl;

    const { error } = await supabase
    .from('transaksi')
    .insert([{tanggal,nominal,keterangan,bukti_url}]);

    if(error){
        alert(error.message);
        return;
    }

    document.getElementById('tanggal').value='';
    document.getElementById('nominal').value='';
    document.getElementById('keterangan').value='';
    document.getElementById('bukti').value='';

    loadData();
}

loadData();
</script>

</body>
</html>